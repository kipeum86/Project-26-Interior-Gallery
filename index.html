<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Our New Home - Interior Gallery</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;700&display=swap" rel="stylesheet">
  <style>
    *,
    *::before,
    *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html,
    body {
      height: 100%;
      overflow: hidden;
    }

    body {
      font-family: "Instrument Sans", sans-serif;
      -webkit-font-smoothing: antialiased;
      background-color: #2E2A27; /* Updated initial fallback to dark tone */
    }

    .slider {
      width: 100%;
      height: 100vh;
      height: 100dvh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      cursor: none;
    }

    .slider__header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 24px 32px;
      flex-shrink: 0;
    }

    .slider__menu {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: 1px solid rgba(255, 255, 255, 0.4); /* 투명도 증가 (0.6 -> 0.4) */
      background: none;
      cursor: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 5px;
      transition: border-color 0.3s ease;
    }

    .slider__menu:hover {
      border-color: rgba(255, 255, 255, 0.8);
    }

    .slider__menu span {
      width: 18px;
      height: 1px;
      background: rgba(255, 255, 255, 0.6); /* 투명도 증가 */
    }

    .slider__label {
      font-size: 11px;
      letter-spacing: 1.5px;
      color: rgba(255, 255, 255, 0.6); /* 투명도 증가 (0.9 -> 0.6) */
      text-transform: uppercase;
      display: none;
    }

    .slider__body {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 0 32px 40px;
      min-height: 0;
      position: relative;
    }

    .slider__left {
      display: flex;
      flex-direction: column;
      flex: 1;
      min-height: 0;
      position: relative;
      z-index: 4;
      max-width: 100%;
    }

    .slider__title {
      font-size: clamp(28px, 5vw, 64px); 
      font-weight: 700;
      color: rgba(255, 255, 255, 0.45); /* 타이틀 투명도 대폭 증가 (0.75 -> 0.45) */
      text-shadow: 0px 4px 12px rgba(0, 0, 0, 0.05); /* 그림자도 더 연하게 완화 */
      line-height: 1.15;
      letter-spacing: -0.02em;
      overflow: hidden;
      position: relative;
      margin-top: auto;
      margin-bottom: auto;
      word-break: keep-all;
      padding-right: 20px;
    }

    .slider__title span {
      display: inline-block;
      will-change: transform;
    }

    .slider__footer {
      flex-shrink: 0;
      margin-top: 32px;
    }

    .slider__description {
      font-size: 10px;
      letter-spacing: 1.2px;
      color: rgba(255, 255, 255, 0.6); /* 투명도 증가 (0.9 -> 0.6) */
      line-height: 1.6;
      text-transform: uppercase;
    }

    .slider__location {
      font-size: 10px;
      letter-spacing: 1.2px;
      color: rgba(255, 255, 255, 0.6); /* 투명도 증가 (0.9 -> 0.6) */
      line-height: 1.6;
      text-transform: uppercase;
      margin-top: 12px;
    }

    .slider__cursor {
      position: fixed;
      top: 0;
      left: 0;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: 1px solid rgba(255, 255, 255, 0.4); /* 커서 테두리 투명도 증가 */
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
      will-change: transform;
      z-index: 10;
      color: rgba(255, 255, 255, 0.8); /* 텍스트 투명도 증가 */
      font-size: 24px;
      font-weight: 400;
      background-color: rgba(0, 0, 0, 0.05); /* 배경색 투명하게 */
      backdrop-filter: blur(2px);
    }

    .slider__right {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none;
    }

    .slider__images {
      width: 100%;
      height: 100%;
      position: relative;
    }

    .slider__slide {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 88%; /* 크기 확대 (기존 80%) */
      aspect-ratio: 16 / 9;
      overflow: hidden;
      will-change: transform, filter, opacity;
      contain: layout style;
    }

    .slider__slide--portrait {
      width: 75%; /* 크기 확대 (기존 65%) */
      aspect-ratio: 3 / 4;
      max-height: 85vh; /* 높이 제한 살짝 완화 */
    }

    .slider__slide img {
      width: 100%;
      height: 100%;
      object-fit: cover; /* Changed from contain to cover for better modern feel */
      filter: drop-shadow(0 20px 40px rgba(0,0,0,0.3)) brightness(0.95);
      border-radius: 4px; /* Added subtle rounding */
    }

    @media screen and (min-width: 768px) {
      .slider__header {
        padding: 40px 56px;
      }

      .slider__label {
        display: flex;
      }

      .slider__body {
        padding: 0 56px 56px;
      }

      .slider__footer {
        margin-top: 48px;
      }

      .slider__slide {
        width: 92%; /* 크기 확대 (기존 85%) */
      }

      .slider__slide--portrait {
        width: 60%; /* 크기 확대 (기존 50%) */
      }

      .slider__cursor {
        width: 88px;
        height: 88px;
      }
    }

    @media screen and (min-width: 1024px) {
      .slider__body {
        flex-direction: row;
      }

      .slider__left {
        width: 35%;
        flex-shrink: 0;
        z-index: auto;
      }

      .slider__right {
        position: static;
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 0;
        opacity: 1;
        pointer-events: auto;
      }

      .slider__slide {
        width: 96%; /* 데스크탑 크기 최대화 (기존 90%) */
      }

      .slider__slide--portrait {
        width: 55%; /* 데스크탑 세로사진 크기 확대 (기존 45%) */
      }
    }

    @media (prefers-reduced-motion: reduce) {
      .slider__slide,
      .slider__title span {
        will-change: auto;
      }
    }
  </style>
</head>
<body>

  <section class="slider">
    <div class="slider__header">
      <button class="slider__menu" aria-label="Open menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <span class="slider__label">OUR NEW HOME '26</span>
    </div>

    <div class="slider__body">
      <div class="slider__left">
        <h2 class="slider__title" aria-live="polite"></h2>
        <div class="slider__footer">
          <div class="slider__info">
            <p class="slider__description">NEW APARTMENT INTERIOR<br>RENOVATION PROJECT<br>COMPLETED IN 2026</p>
            <p class="slider__location">THOUGHTFULLY<br>CRAFTED SPACES.</p>
          </div>
        </div>
      </div>
      <div class="slider__right">
        <div class="slider__images"></div>
      </div>
    </div>
  </section>

  <!-- Load GSAP -->
  <script src="https://unpkg.com/gsap@3/dist/gsap.min.js"></script>
  <script>
    const throttle = (callback, limit) => {
      let waiting = false;
      return function () {
        if (!waiting) {
          callback.apply(this, arguments);
          waiting = true;
          setTimeout(() => {
            waiting = false;
          }, limit);
        }
      };
    };

    const debounce = (func, wait, immediate) => {
      let timeout;
      return function () {
        const context = this;
        const args = arguments;
        const later = function () {
          timeout = null;
          if (!immediate) func.apply(context, args);
        };
        const callNow = immediate && !timeout;
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
        if (callNow) func.apply(context, args);
      };
    };

    // Updated SLIDES with darker backgrounds for better contrast
    // Restored all images to imgur URLs as requested so they render properly
    const SLIDES = [
      { name: "Art & Vibe", color: "#2E2A27", image: "https://imgur.com/frbFY3D.jpg", isPortrait: false },
      { name: "Open Living", color: "#3B332D", image: "https://imgur.com/7PvqOpd.jpg", isPortrait: false },
      { name: "Hallway View", color: "#2B2D2F", image: "https://imgur.com/2kPrZCo.jpg", isPortrait: false },
      { name: "Entrance", color: "#36312D", image: "https://imgur.com/9tmQPMt.jpg", isPortrait: true },
      { name: "Living Room", color: "#282A2B", image: "https://imgur.com/iiuMK2Z.jpg", isPortrait: false },
      { name: "Modern Kitchen", color: "#3A3430", image: "https://imgur.com/gyY3VNO.jpg", isPortrait: false },
      { name: "Countertop", color: "#33302D", image: "https://imgur.com/ZT6Tixq.jpg", isPortrait: true },
      { name: "Kitchen Space", color: "#2F3130", image: "https://imgur.com/MrprZ9b.jpg", isPortrait: false },
      { name: "Cozy Nook", color: "#353236", image: "https://imgur.com/1BTRvqs.jpg", isPortrait: true },
      { name: "Home Office", color: "#2A2725", image: "https://imgur.com/S1GcfEw.jpg", isPortrait: true },
      { name: "Workspace", color: "#383431", image: "https://imgur.com/c0oLfxB.jpg", isPortrait: true },
      { name: "Main Bath", color: "#2C2D2C", image: "https://imgur.com/KqDHFhI.jpg", isPortrait: true },
      { name: "Bath Details", color: "#33312E", image: "https://imgur.com/A3po2hp.jpg", isPortrait: true },
      { name: "Master Closet", color: "#2E2A28", image: "https://imgur.com/79I00tM.jpg", isPortrait: false },
      { name: "Wardrobe", color: "#292A2C", image: "https://imgur.com/VUwpU4A.jpg", isPortrait: true },
      { name: "Master Bath", color: "#262626", image: "https://imgur.com/XWT6Icj.jpg", isPortrait: true }
    ];

    const AUTOPLAY_DELAY = 4000;

    class Slider {
      constructor() {
        this.current = 0;
        this.animating = false;
        this.total = SLIDES.length;
        this.el = document.querySelector(".slider");
        this.titleEl = document.querySelector(".slider__title");
        this.imagesEl = document.querySelector(".slider__images");
        this.slideEls = [];
        this.currentLine = null;
        this.cursorVisible = false;
        this.autoPlayId = null;
        this.reducedMotion = window.matchMedia(
          "(prefers-reduced-motion: reduce)"
        ).matches;

        this.preload();
        this.setTitle(SLIDES[0].name);
        gsap.set(this.el, { backgroundColor: SLIDES[0].color });
        this.buildCarousel();
        this.buildCursor();
        this.bind();
        this.startAutoPlay();
      }

      preload() {
        SLIDES.forEach((s) => {
          new Image().src = s.image;
        });
      }

      mod(n) {
        return ((n % this.total) + this.total) % this.total;
      }

      buildCursor() {
        this.cursorEl = document.createElement("div");
        this.cursorEl.className = "slider__cursor";
        this.cursorEl.textContent = "VIEW"; // Changed from + to VIEW for better UX
        this.cursorEl.style.fontSize = "12px";
        this.cursorEl.style.letterSpacing = "1px";
        this.cursorEl.setAttribute("aria-hidden", "true");
        this.el.appendChild(this.cursorEl);
        gsap.set(this.cursorEl, { xPercent: -50, yPercent: -50, opacity: 0 });
        this.cursorMoveX = gsap.quickTo(this.cursorEl, "x", {
          duration: 0.3, // Faster cursor response
          ease: "power3"
        });
        this.cursorMoveY = gsap.quickTo(this.cursorEl, "y", {
          duration: 0.3,
          ease: "power3"
        });
      }

      startAutoPlay() {
        this.stopAutoPlay();
        this.autoPlayId = setInterval(() => {
          if (!this.animating) this.go("next");
        }, AUTOPLAY_DELAY);
      }

      stopAutoPlay() {
        if (this.autoPlayId) {
          clearInterval(this.autoPlayId);
          this.autoPlayId = null;
        }
      }

      setTitle(text) {
        this.titleEl.innerHTML = "";
        const line = document.createElement("div");
        [...text].forEach((ch) => {
          const span = document.createElement("span");
          span.innerHTML = ch === " " ? "&nbsp;" : ch; 
          line.appendChild(span);
        });
        this.titleEl.appendChild(line);
        this.currentLine = line;
      }

      animateTitle(newText, direction) {
        const h = this.titleEl.offsetHeight;
        const dir = direction === "next" ? 1 : -1;
        const oldLine = this.currentLine;
        const oldChars = [...oldLine.querySelectorAll("span")];

        this.titleEl.style.height = h + "px";
        oldLine.style.cssText = "position:absolute;top:0;left:0;width:100%";

        const newLine = document.createElement("div");
        newLine.style.cssText = "position:absolute;top:0;left:0;width:100%";
        [...newText].forEach((ch) => {
          const span = document.createElement("span");
          span.innerHTML = ch === " " ? "&nbsp;" : ch;
          newLine.appendChild(span);
        });
        this.titleEl.appendChild(newLine);

        const newChars = [...newLine.querySelectorAll("span")];
        gsap.set(newChars, { y: h * dir });

        const duration = this.reducedMotion ? 0.01 : 0.6; // Reduced from 1.0 to 0.6
        const stagger = this.reducedMotion ? 0 : 0.02; // Reduced from 0.04 to 0.02

        const tl = gsap.timeline({
          onComplete: () => {
            oldLine.remove();
            newLine.style.cssText = "";
            gsap.set(newChars, { clearProps: "all" });
            this.titleEl.style.height = "";
            this.currentLine = newLine;
          }
        });

        tl.to(
          oldChars,
          {
            y: -h * dir,
            stagger: stagger,
            duration: duration,
            ease: "power2.inOut" // Changed from expo for slightly softer but fast feel
          },
          0
        );

        tl.to(
          newChars,
          {
            y: 0,
            stagger: stagger,
            duration: duration,
            ease: "power2.inOut"
          },
          0
        );

        return tl;
      }

      makeSlide(idx) {
        const div = document.createElement("div");
        div.className = "slider__slide";
        if (SLIDES[idx].isPortrait) {
          div.classList.add("slider__slide--portrait");
        }
        const img = document.createElement("img");
        img.src = SLIDES[idx].image;
        img.alt = SLIDES[idx].name;
        div.appendChild(img);
        return div;
      }

      getSlideProps(step) {
        const h = this.imagesEl.offsetHeight;
        const absStep = Math.abs(step);
        const positions = [
          { x: -0.35, y: -0.95, rot: -30, s: 1.35, b: 16, o: 0 },
          { x: -0.18, y: -0.5, rot: -15, s: 1.15, b: 8, o: 0.55 },
          { x: 0, y: 0, rot: 0, s: 1, b: 0, o: 1 },
          { x: -0.06, y: 0.5, rot: 15, s: 0.75, b: 6, o: 0.55 },
          { x: -0.12, y: 0.95, rot: 30, s: 0.55, b: 14, o: 0 }
        ];
        const idx = Math.max(0, Math.min(4, step + 2));
        const p = positions[idx];

        return {
          x: p.x * h,
          y: p.y * h,
          rotation: p.rot,
          scale: p.s,
          blur: p.b,
          opacity: p.o,
          zIndex: absStep === 0 ? 3 : absStep === 1 ? 2 : 1
        };
      }

      positionSlide(slide, step) {
        const props = this.getSlideProps(step);
        gsap.set(slide, {
          xPercent: -50,
          yPercent: -50,
          x: props.x,
          y: props.y,
          rotation: props.rotation,
          scale: props.scale,
          opacity: props.opacity,
          filter: "blur(" + props.blur + "px)",
          zIndex: props.zIndex
        });
      }

      buildCarousel() {
        if (!this.imagesEl || this.imagesEl.offsetHeight === 0) return;
        this.imagesEl.innerHTML = "";
        this.slideEls = [];

        for (let step = -1; step <= 1; step++) {
          const idx = this.mod(this.current + step);
          const slide = this.makeSlide(idx);
          this.imagesEl.appendChild(slide);
          this.positionSlide(slide, step);
          this.slideEls.push({ el: slide, step: step });
        }
      }

      animateCarousel(direction) {
        if (!this.imagesEl || this.imagesEl.offsetHeight === 0)
          return gsap.timeline();

        const shift = direction === "next" ? -1 : 1;
        const enterStep = direction === "next" ? 2 : -2;
        const newIdx =
          direction === "next"
            ? this.mod(this.current + 2)
            : this.mod(this.current - 2);

        const newSlide = this.makeSlide(newIdx);
        this.imagesEl.appendChild(newSlide);
        this.positionSlide(newSlide, enterStep);
        this.slideEls.push({ el: newSlide, step: enterStep });

        this.slideEls.forEach((s) => {
          s.step += shift;
        });

        const duration = this.reducedMotion ? 0.01 : 0.7; // Reduced from 1.2 to 0.7

        const tl = gsap.timeline({
          onComplete: () => {
            this.slideEls = this.slideEls.filter((s) => {
              if (Math.abs(s.step) >= 2) {
                s.el.remove();
                return false;
              }
              return true;
            });
          }
        });

        this.slideEls.forEach((s) => {
          const props = this.getSlideProps(s.step);
          s.el.style.zIndex = props.zIndex;

          tl.to(
            s.el,
            {
              x: props.x,
              y: props.y,
              rotation: props.rotation,
              scale: props.scale,
              opacity: props.opacity,
              filter: "blur(" + props.blur + "px)",
              duration: duration,
              ease: "power2.inOut" // Changed from power3 for snappier movement
            },
            0
          );
        });

        return tl;
      }

      go(direction) {
        if (this.animating) return;
        this.animating = true;
        this.startAutoPlay();

        const nextIdx =
          direction === "next"
            ? this.mod(this.current + 1)
            : this.mod(this.current - 1);

        const master = gsap.timeline({
          onComplete: () => {
            this.current = nextIdx;
            this.animating = false;
          }
        });

        master.to(
          this.el,
          {
            backgroundColor: SLIDES[nextIdx].color,
            duration: this.reducedMotion ? 0.01 : 0.7, // Reduced from 1.2 to 0.7
            ease: "power2.inOut"
          },
          0
        );

        master.add(this.animateTitle(SLIDES[nextIdx].name, direction), 0);
        master.add(this.animateCarousel(direction), 0);
      }

      bind() {
        // Reduced throttle from 1800ms to 800ms for more responsive scrolling
        const onWheel = throttle((e) => {
          if (this.animating) return;
          this.go(e.deltaY > 0 ? "next" : "prev");
        }, 800);
        window.addEventListener("wheel", onWheel, { passive: true });

        let touchStartY = 0;
        window.addEventListener(
          "touchstart",
          (e) => {
            touchStartY = e.touches[0].clientY;
          },
          { passive: true }
        );

        // Reduced throttle here as well
        const onTouchEnd = throttle((e) => {
          if (this.animating) return;
          const diff = touchStartY - e.changedTouches[0].clientY;
          if (Math.abs(diff) < 40) return;
          this.go(diff > 0 ? "next" : "prev");
        }, 800);
        window.addEventListener("touchend", onTouchEnd, { passive: true });

        window.addEventListener("keydown", (e) => {
          if (this.animating) return;
          if (e.key === "ArrowDown" || e.key === "ArrowRight") this.go("next");
          if (e.key === "ArrowUp" || e.key === "ArrowLeft") this.go("prev");
        });

        this.el.addEventListener(
          "mousemove",
          (e) => {
            if (!this.cursorVisible) {
              gsap.to(this.cursorEl, { opacity: 1, duration: 0.3 });
              this.cursorVisible = true;
            }
            this.cursorMoveX(e.clientX);
            this.cursorMoveY(e.clientY);
          },
          { passive: true }
        );

        this.el.addEventListener("mouseleave", () => {
          gsap.to(this.cursorEl, { opacity: 0, duration: 0.3 });
          this.cursorVisible = false;
        });

        const onResize = debounce(() => {
          if (!this.animating && this.imagesEl.offsetHeight > 0) {
            this.slideEls.forEach((s) => {
              this.positionSlide(s.el, s.step);
            });
          }
        }, 300);
        window.addEventListener("resize", onResize, { passive: true });

        document.addEventListener("visibilitychange", () => {
          if (document.visibilityState === "hidden") {
            this.animating = false;
            this.stopAutoPlay();
          } else {
            this.startAutoPlay();
          }
        });
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      new Slider();
    });
  </script>
</body>
</html>
